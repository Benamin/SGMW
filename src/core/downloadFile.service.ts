import {AlertController, LoadingController, Platform} from "ionic-angular";import {File} from "@ionic-native/file";import {FileTransfer, FileTransferObject} from "@ionic-native/file-transfer";import {Injectable} from "@angular/core";import {CommonService} from "./common.service";import {PhotoLibrary} from "@ionic-native/photo-library";@Injectable()export class DownloadFileService {    constructor(private platform: Platform,                public file: File,                public commonSer: CommonService,                public transfer: FileTransfer,                public alertCtrl: AlertController,                private photoLibrary: PhotoLibrary,                public loadingCtrl: LoadingController) {    }    downloadVideo(fileName, fileUrl) {        // fileUrl = 'http://clips.vorwaerts-gmbh.de/big_buck_bunny.mp4';        // fileName = 'demo.mp4';        if (this.platform.is('android')) {            this.downloadForAndroid(fileUrl, fileName)        }        if (this.platform.is('ios')) {            this.downloadForIOS(fileUrl, fileName)        }    }    downloadForAndroid(fileUrl, fileName) {        this.file.createDir(this.file.externalRootDirectory, 'courseFile', true).then((result) => {            console.log("Directory created" + result);        });        const storageDirectory = this.file.externalRootDirectory + 'courseFile/';        const uploadLoading = this.loadingCtrl.create({            content: '下载中...',            dismissOnPageChange: true,            enableBackdropDismiss: true,        });        uploadLoading.present();        const fileTransfer: FileTransferObject = this.transfer.create();        this.commonSer.alert("externalRootDirectory：" + storageDirectory);        fileTransfer.download(fileUrl, storageDirectory + fileName).then((entry) => {            uploadLoading.dismiss();            this.commonSer.alert('download complete: ' + entry.toURL());        }, (error) => {            uploadLoading.dismiss();            this.commonSer.alert(JSON.stringify(error));        });        fileTransfer.onProgress(listener => {            let per = <any>(listener.loaded / listener.total) * 100;            per = Math.round(per * Math.pow(10, 2)) / Math.pow(10, 2);            uploadLoading.setContent('下载中...' + per + '%');        })    }    downloadForIOS(fileUrl, fileName) {        const uploadLoading = this.loadingCtrl.create({            content: '下载中...',            dismissOnPageChange: true,            enableBackdropDismiss: true,        });        uploadLoading.present();        const fileTransfer: FileTransferObject = this.transfer.create();        this.commonSer.alert("storageDirectory：" + this.file.dataDirectory);        fileTransfer.download(fileUrl, this.file.dataDirectory + fileName).then((entry) => {            this.photoLibrary.saveVideo(entry.toURL(), 'sgmw').then((success) => {                uploadLoading.dismiss();                this.commonSer.toast('视频下载成功')            }, (err) => {                uploadLoading.dismiss();                this.commonSer.alert(JSON.stringify(err));            })        }, (error) => {            uploadLoading.dismiss();            this.commonSer.alert(JSON.stringify(error));        });        fileTransfer.onProgress(listener => {            let per = <any>(listener.loaded / listener.total) * 100;            per = Math.round(per * Math.pow(10, 2)) / Math.pow(10, 2)            uploadLoading.setContent('下载中...' + per + '%');        })    }}