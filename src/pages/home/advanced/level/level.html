<ion-header>
  <ion-navbar>
    <ion-title>岗位认证</ion-title>
    <div class="top-box">
          <span class="top-right" (click)="showActionSheet()">
            <span>岗位切换</span>
            <img src="assets/imgs/advanced/rzjj_xz@2x.png" alt="">
          </span>
    </div>
  </ion-navbar>
</ion-header>

<ion-content>

  <div class="user-box">
    <div class="img-head">
      <img src="{{page.mineInfo?.HeadPhoto}}" alt="头像">
    </div>
    <span class="name-text">{{page.mineInfo?.UserName}}</span>
    <span class="now-level">{{ page.levelTypeText }}</span>
  </div>

  <div class="level-box">
    <div class="rule-tip">
      <span>{{ page.levelTypeText }}岗位分级</span>
      <span class="rule-tip-text" (click)="getModalData()">
        <img class="rule-icon" src="assets/imgs/advanced/rule-icon.png" alt="">
        岗位分级说明
      </span>
    </div>
    <div class="progress-box">
      <div class="progress-bar-bg"></div>
      <div class="progress-bar" [ngStyle]="{'width': (page.nowLevel/(page.levelInformation.length-1) * 100) + ((1/(page.levelInformation.length - 1) * (page.nowProgress * 100))) + '%' }">
        <!-- 小于50%就在进度右边 大于50% 就在进度左边 -->
        <span class="process-text" *ngIf="page.isLoaded && (page.nowProgress * 100).toFixed(0) >= 50">
          {{ (page.nowProgress * 100).toFixed(0) }}%
        </span>
        <span class="process-text out-box" *ngIf="page.isLoaded && (page.nowProgress * 100).toFixed(0) < 50">
          {{ (page.nowProgress * 100).toFixed(0) }}%
        </span>
      </div>
      <!-- 当前进度 等于 当前等级/总等级的数量*100 + '%' 再加上当前进度乘以 (1/(总等级的数量)*100) + '%' -->
      <!--<div class="progress-bar" style="z-index: 3;background: transparent;" [ngStyle]="{'width': ((page.nowLevel + 1)/(page.levelInformation.length-1) * 100) + '%' }">-->

        <!--<span class="process-text" *ngIf="page.isLoaded">-->
          <!--{{ (page.nowProgress * 100).toFixed(0) }}%-->
        <!--</span>-->
        <!--&lt;!&ndash;分隔符&ndash;&gt;-->
        <!--&lt;!&ndash;<span *ngIf="page.nowLevel < page.levelInformation.length - 2" class="process-line"></span>&ndash;&gt;-->
      <!--</div>-->
      <!--<div class="progress-bar"  [ngStyle]="{'width': (page.nowLevel/(page.levelInformation.length-1)*100) + '%' }"></div>-->
    </div>

    <div class="level-scroll-box">
      <ul class="level-type-box">
        <li *ngFor="let item of page.levelInformation; let levelTypeIndex = index" (click)="switchLevel(levelTypeIndex, item.Hierarchy > page.nowLevel + 1)" [ngClass]="{'actived': item.actived, 'disabled': item.Hierarchy > page.nowLevel + 1}">
           <div [innerHTML]="assembleHTML(item.LevelText)"></div>
        </li>
        <!--<li class="actived">实习顾问</li>-->
        <!--<li>销售顾问</li>-->
        <!--<li>体验专家</li>-->
      </ul>
    </div>
  </div>

  <div class="lists-box">

    <div class="nav-type">
      <div class="nav-box">
        <div class="btn-box">

          <div (click)="changeNav(navIndex, item.isActived)" *ngFor="let item of page.navliArr; let navIndex = index"
               class="type-btn" [ngClass]="{'actived': item.isActived}">
            {{ item.navBtnText }}
            <span class="item-line"></span>
          </div>

        </div>
      </div>
    </div>

    <!-- 课程列表 -->
    <div *ngIf="page.navliArr[0].isActived === true">
      <div class="sec-nav-type">
        <div class="nav-box">
          <div class="btn-box">

            <div *ngFor="let item of page.courseTypeArr; let navSecIndex = index">
              <div *ngIf="navSecIndex !== 3"
                   (click)="changeSecNav(navSecIndex, item.isActived)"
                   class="type-btn"
                   [ngClass]="{'actived': item.isActived}">
                {{ item.navBtnText }}
                <span class="item-line"></span>
              </div>
              <div *ngIf="navSecIndex === 3"
                   (click)="goAdvancedLists()"
                   class="type-btn"
                   [ngClass]="{'actived': item.isActived}">
                {{ item.navBtnText }}
                <span class="item-line"></span>
              </div>
            </div>

          </div>
        </div>
      </div>
      <div *ngFor="let item of page.navliArr[0].lists; let courseIndex = index">
        <div class="course-li" (click)="goCourse(item)">
          <img [src]="item.ImageUrl || page.defaultImg" alt="课程图片">
          <div class="course-right">
            <div class="title article">
              {{ item.Title }}
            </div>
            <div class="SubjectName">
              {{item.SubjectName}}
            </div>
            <div class="status" *ngIf="item.studystate === 0">
              <img src="assets/imgs/advanced/status-default.png"/>
              未开始
            </div>
            <div class="status" *ngIf="item.studystate === 1">
              <img src="assets/imgs/advanced/status-doing.png"/>
              进行中
            </div>
            <div class="status" *ngIf="item.studystate === 2 || item.studystate === -1">
              <img src="assets/imgs/advanced/status-finish.png"/>
              已完成
            </div>
          </div>
        </div>
      </div>

      <div *ngIf="page.navliArr[0].lists.length === 0 && page.isLoaded" style="margin-top: 2.5rem;text-align: center;color: #999;">暂无数据</div>

    </div>
    <!-- 课程列表 end -->
    <!-- 考试列表 -->
    <div *ngIf="page.navliArr[1].isActived === true">
      <div class="sec-nav-type">
        <div class="nav-box">
          <div class="btn-box">
            <div *ngFor="let item of page.courseTypeArr; let navSecIndex = index">

              <div *ngIf="navSecIndex !== 3" (click)="changeSecNav(navSecIndex, item.isActived)"
                   class="type-btn"
                   [ngClass]="{'actived': item.isActived}">
                {{ item.navBtnText }}
                <span class="item-line"></span>
              </div>

            </div>
          </div>
        </div>
      </div>

      <div *ngFor="let item of page.navliArr[1].lists; let examIndex = index">
        <div class="item-exam" (click)="goExam(item)">
          <div class="exam-li">
            <img [src]="item.PictureSrc || page.defaultImg" alt="课程图片">
            <div class="exam-right">
              <div class="title">{{ item.EName }}</div>
              <div class="achievement">本场考试：{{ item.PassScore + '分通过' }}</div>
              <div class="right_bottom">
                <span style="color: #666;">时间：{{ item.ExamTimer === 0 ? '不限时' : item.ExamTimer + '分钟' }}</span>
                <div class="status" *ngIf="item.TotalScore >= item.PassScore">
                  <img src="assets/imgs/advanced/logo-actived.png"/>
                  <!-- <img src="assets/imgs/advanced/status-finish.png"/> -->
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div *ngIf="page.navliArr[1].lists.length === 0 && page.isLoaded" style="margin-top: 2.5rem;text-align: center;color: #999;">暂无数据</div>

    </div>
    <!-- 考试列表 end -->

    <!-- KPI -->
    <div *ngIf="page.navliArr[2].isActived === true">
      <div class="kpi-title" *ngIf="page.navliArr[2].lists.length > 0">岗位业绩指标</div>

      <div *ngFor="let item of page.navliArr[2].lists; let kpiIndex = index">
        <div class="kpi-item">
          <div class="kpi-item-title">{{ item.KpiName }}</div>
          <div class="progress-box">
            <div class="progress-bar-bg"></div>
            <div *ngIf="item.QualifiedKpiValue !== 0" class="progress-bar" [ngStyle]="{'width': (item.KpiValue/item.QualifiedKpiValue*100) + '%' }"></div>
            <div *ngIf="item.QualifiedKpiValue === 0" class="progress-bar" style="width: 100%;"></div>
          </div>
          <div class="kpi-item-text">
            <span class="progress-now" [ngClass]="{'finish': item.KpiValue >= item.QualifiedKpiValue }">当前{{( item.KpiValue * 100).toFixed(0) }}%</span>
            <span class="progress-target">目标{{( item.QualifiedKpiValue * 100).toFixed(0) }}%</span>
          </div>
        </div>
      </div>

      <div *ngIf="page.navliArr[2].lists.length === 0 && page.isLoaded" style="margin-top: 2.5rem;text-align: center;color: #999;">暂无数据</div>

    </div>
    <!-- KPI end -->

    <!-- 评分 -->
    <div *ngIf="page.navliArr[3].isActived === true">
      <!--<div class="kpi-title">试乘试驾操作评分</div>-->

      <div *ngFor="let item of page.navliArr[3].lists; let kpiIndex = index">

        <div class="kpi-item" *ngIf="item.IsExist">
          <div class="kpi-item-title">试乘试驾操作评分</div>
          <div class="progress-box">
            <div class="progress-bar-bg"></div>
            <div class="progress-bar" [ngStyle]="{'width': (item.Score/item.QualifiedScore*100) + '%' }"></div>
          </div>
          <div class="kpi-item-text">
            <span class="progress-now" [ngClass]="{'finish': item.IsQualified }">当前{{ item.Score }}分</span>
            <span class="progress-target">目标{{ item.QualifiedScore }}分</span>
          </div>
        </div>

        <div *ngIf="page.navliArr[3].lists.length === 1 && !item.IsExist" style="margin-top: 2.5rem;text-align: center;color: #999;">暂无数据</div>

      </div>

      <div *ngIf="page.navliArr[3].lists.length === 0 && page.isLoaded" style="margin-top: 2.5rem;text-align: center;color: #999;">暂无数据</div>

    </div>
    <!-- 评分 end -->

  </div>

</ion-content>
